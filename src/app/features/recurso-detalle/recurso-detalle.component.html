<p-toast></p-toast>
<p-dialog
  header="Confirmar reserva"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [visible]="dialogVisible()"
  (onHide)="cerrarDialogo()"
>
  <div class="flex flex-column gap-3">
    @if (slotSeleccionado()) {
      <div class="text-500">
        Reservar {{ slotSeleccionado()?.inicio | date: 'shortTime' }} - {{ slotSeleccionado()?.fin | date: 'shortTime' }}
      </div>
    }
    <div class="flex flex-column gap-2">
      <label for="motivo">Motivo (opcional)</label>
      <textarea id="motivo" pInputTextarea [(ngModel)]="motivo" rows="2"></textarea>
    </div>
    <div class="flex justify-content-end gap-2">
      <button pButton type="button" label="Cancelar" class="p-button-text" (click)="cerrarDialogo()"></button>
      <button pButton type="button" label="Reservar" icon="pi pi-check" (click)="reservarTurno()"></button>
    </div>
  </div>
</p-dialog>

<div class="mb-3">
  <a routerLink="/recursos" class="flex align-items-center gap-2 text-color">
    <i class="pi pi-arrow-left"></i>
    Volver a recursos
  </a>
</div>

@if (recurso()) {
  <p-card
    class="mb-4"
    [header]="recurso()?.nombre"
    [subheader]="recurso()?.tipoRecurso?.nombre || 'Tipo no especificado'"
  >
    <p class="mb-3">{{ recurso()?.descripcion || 'Sin descripción' }}</p>
    <div class="flex align-items-center gap-2 mb-2 text-600">
      <span class="pi pi-building text-primary" aria-hidden="true"></span>
      <span>{{ recurso()?.sucursal?.nombre || 'Sucursal no especificada' }}</span>
    </div>
    <p-tag [severity]="recurso()?.activo ? 'success' : 'danger'">
      {{ recurso()?.activo ? 'Activo' : 'Inactivo' }}
    </p-tag>
  </p-card>
}

<div class="grid gap-3">
  <div class="col-12 md:col-4">
    <p-card header="Seleccioná una fecha">
      <p-date-picker
        [(ngModel)]="fechaSeleccionada"
        dateFormat="yy-mm-dd"
        [minDate]="hoy"
        (onSelect)="cargarSlots()"
        class="w-full"
      ></p-date-picker>
      <div class="mt-3 flex gap-2">
        <button pButton type="button" label="Buscar slots" icon="pi pi-search" (click)="cargarSlots()"></button>
      </div>
    </p-card>
  </div>
  <div class="col-12 md:col-8">
    <p-card header="Slots disponibles">
      @if (slots().length === 0) {
        <div class="text-500">No hay slots para la fecha seleccionada.</div>
      } @else {
        <div class="flex flex-column gap-2">
          @for (slot of slots(); track slot.inicio) {
            <div class="flex align-items-center justify-content-between border-round surface-ground p-2 transition-duration-100 hover:surface-200">
              <div>
                <div class="font-medium">
                  {{ slot.inicio | date: 'shortTime' }} - {{ slot.fin | date: 'shortTime' }}
                </div>
                <small class="text-500">Capacidad disponible: {{ slot.capacidadLibre }}</small>
              </div>
              <button pButton type="button" label="Reservar" icon="pi pi-calendar-plus" (click)="abrirDialogo(slot)"></button>
            </div>
          }
        </div>
      }
    </p-card>
  </div>
</div>
